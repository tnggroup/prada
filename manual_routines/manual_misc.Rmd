# Command wrappers

```sh

srun -p cpu --time 4:00:00 --ntasks 1 --cpus-per-task 6 --mem 32G --pty /bin/bash

```

## PGS feasibility check across region coverages

We measure the performance of PGS with the coverace of polygenic regions. We compare to the genome-wide case, using GLAD+ genotyped data.

```sh

sbatch --time 3:00:00 --partition cpu --job-name="munge" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R MDDIDP" --output "prs.munge.cojo.MDDIDP.$(date +%Y%m%d).out.txt"
sbatch --time 3:00:00 --partition cpu --job-name="munge" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R BIPO03" --output "prs.munge.cojo.BIPO03.$(date +%Y%m%d).out.txt"
sbatch --time 3:00:00 --partition cpu --job-name="munge" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R ADHD06" --output "prs.munge.cojo.ADHD06.$(date +%Y%m%d).out.txt"
sbatch --time 3:00:00 --partition cpu --job-name="munge" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R SCHI06" --output "prs.munge.cojo.SCHI06.$(date +%Y%m%d).out.txt"
sbatch --time 3:00:00 --partition cpu --job-name="munge" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R SMOK11" --output "prs.munge.cojo.SMOK11.$(date +%Y%m%d).out.txt"


sbatch --time 2-00:00:00 --partition cpu --job-name="MDDIDP" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R MDDIDP" --output "sbayesrc.tidyimpute.MDDIDP.$(date +%Y%m%d).out.txt"
sbatch --time 2-00:00:00 --partition cpu --job-name="BIPO03" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R BIPO03" --output "sbayesrc.tidyimpute.BIPO03.$(date +%Y%m%d).out.txt"
sbatch --time 2-00:00:00 --partition cpu --job-name="ADHD06" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R ADHD06" --output "sbayesrc.tidyimpute.ADHD06.$(date +%Y%m%d).out.txt"
sbatch --time 2-00:00:00 --partition cpu --job-name="SCHI06" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R SCHI06" --output "sbayesrc.tidyimpute.SCHI06.$(date +%Y%m%d).out.txt"
sbatch --time 2-00:00:00 --partition cpu --job-name="SMOK11" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R SMOK11" --output "sbayesrc.tidyimpute.SMOK11.$(date +%Y%m%d).out.txt"


sbatch --time 2-00:00:00 --partition cpu --job-name="MDDIDP" --ntasks 1 --cpus-per-task 8 --mem 32G --wrap="Rscript ../manual_routines/prs-check-gladp.R MDDIDP" --output "sbayesrc.score.MDDIDP.$(date +%Y%m%d).out.txt"
sbatch --time 2-00:00:00 --partition cpu --job-name="BIPO03" --ntasks 1 --cpus-per-task 8 --mem 32G --wrap="Rscript ../manual_routines/prs-check-gladp.R BIPO03" --output "sbayesrc.score.BIPO03.$(date +%Y%m%d).out.txt"
sbatch --time 2-00:00:00 --partition cpu --job-name="ADHD06" --ntasks 1 --cpus-per-task 8 --mem 32G --wrap="Rscript ../manual_routines/prs-check-gladp.R ADHD06" --output "sbayesrc.score.ADHD06.$(date +%Y%m%d).out.txt"
sbatch --time 2-00:00:00 --partition cpu --job-name="SCHI06" --ntasks 1 --cpus-per-task 8 --mem 32G --wrap="Rscript ../manual_routines/prs-check-gladp.R SCHI06" --output "sbayesrc.score.SCHI06.$(date +%Y%m%d).out.txt"
sbatch --time 2-00:00:00 --partition cpu --job-name="SMOK11" --ntasks 1 --cpus-per-task 8 --mem 32G --wrap="Rscript ../manual_routines/prs-check-gladp.R SMOK11" --output "sbayesrc.score.SMOK11.$(date +%Y%m%d).out.txt"


sbatch --time 4:00:00 --partition cpu --job-name="scoring" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R" --output "sbayesrc.scoring.baseline.$(date +%Y%m%d).out.txt"
#needs plink2
sbatch --time 4:00:00 --partition cpu --job-name="scoring" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="Rscript ../manual_routines/prs-check-gladp.R" --output "sbayesrc.scoring.allPolygenic.$(date +%Y%m%d).out.txt"

```

## ONT human variation workflow

### Installation and configuration

```sh

export JAVA_HOME='/scratch/prj/ppn_tng/software/java/jdk-24.0.1'
export JAVA_CMD='/scratch/prj/ppn_tng/software/java/jdk-24.0.1/bin/java'

export NEXTFLOW_CMD='/scratch/prj/ppn_tng/software/nextflow/nextflow-25.04.4-dist'

$NEXTFLOW_CMD pull epi2me-labs/wf-human-variation

$NEXTFLOW_CMD run epi2me-labs/wf-human-variation --help

```

## Singularity

Install singularity. Singularity can't build containers on MacOS currently. You can use a virtual machine (f.ex. using VirtualBox) to run Linux and then build Singularity that can build containers from definitions.
https://github.com/sylabs/singularity/blob/main/INSTALL.md
https://docs.sylabs.io/guides/3.0/user-guide/installation.html


Install prerequisites
```sh
sudo pacman -Syu
sudo pacman -Sy autoconf automake cryptsetup crun fuse2fs git fuse3 libseccomp libtool pkgconf shadow squashfs-tools wget zlib conmon go base-devel

#base-devel includes gcc and make

```

After restart, this is the rouine of the installation.
```sh
#in projects directory
git clone --recurse-submodules https://github.com/sylabs/singularity.git
cd singularity
#git submodule update --init #only if you don't already have the submodules
./mconfig
make -C builddir
sudo make -C builddir install

```


Env. variable configuration, as tested in Archlinux (Manjaro)
```sh

SINGULARITY_TMPDIR="/path/to/tmpdir" #edit this to whichever path you want to use!

```


# Building a mosdepth container/image

This only worked outside the virtual machine shared folder (i.e. on the VM hard drive).

```sh

#this was run historically - using a slimmed down version of mosdepth_c2.def to identify build errors
#sudo singularity build --sandbox mosdepth_c2 /media/sf_mylinux_shared/mosdepth_c2.def

sudo singularity build mosdepth_c2.sif /media/sf_mylinux_shared/mosdepth_c2.def
#singularity build --fakeroot mosdepth_c2.sif /media/sf_mylinux_shared/mosdepth_c2.def #this did not work


```


#Manual mosdepths runs

```sh

#interactive test
#singularity run --bind /scratch/prj/sgdp_nanopore/Projects/prada_jz ~/project/prada_jz/venv/mosdepth_c2.sif -t 6 --fast-mode barcode01 /scratch/prj/sgdp_nanopore/Projects/prada_jz/work/pgx/pilot2/p2-nogtube-nobedtest/output/barcode01/barcode01.haplotagged.bam

sbatch --time 24:00:00 --partition cpu --job-name="md01" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="singularity run --bind /scratch/prj/sgdp_nanopore/Projects/prada_jz ~/project/prada_jz/venv/mosdepth_c2.sif -t 6 --fast-mode barcode01 /scratch/prj/sgdp_nanopore/Projects/prada_jz/work/pgx/pilot2/p2-nogtube-nobedtest/output/barcode01/barcode01.haplotagged.bam" --output "mdepth.barcode01.$(date +%Y%m%d).out.txt"

sbatch --time 24:00:00 --partition cpu --job-name="md02" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="singularity run --bind /scratch/prj/sgdp_nanopore/Projects/prada_jz ~/project/prada_jz/venv/mosdepth_c2.sif -t 6 --fast-mode barcode02 /scratch/prj/sgdp_nanopore/Projects/prada_jz/work/pgx/pilot2/p2-nogtube-nobedtest/output/barcode02/barcode02.haplotagged.bam" --output "mdepth.barcode02.$(date +%Y%m%d).out.txt"

sbatch --time 24:00:00 --partition cpu --job-name="md03" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="singularity run --bind /scratch/prj/sgdp_nanopore/Projects/prada_jz ~/project/prada_jz/venv/mosdepth_c2.sif -t 6 --fast-mode barcode03 /scratch/prj/sgdp_nanopore/Projects/prada_jz/work/pgx/pilot2/p2-nogtube-nobedtest/output/barcode03/barcode03.haplotagged.bam" --output "mdepth.barcode03.$(date +%Y%m%d).out.txt"

sbatch --time 24:00:00 --partition cpu --job-name="md04" --ntasks 1 --cpus-per-task 6 --mem 16G --wrap="singularity run --bind /scratch/prj/sgdp_nanopore/Projects/prada_jz ~/project/prada_jz/venv/mosdepth_c2.sif -t 6 --fast-mode barcode04 /scratch/prj/sgdp_nanopore/Projects/prada_jz/work/pgx/pilot2/p2-nogtube-nobedtest/output/barcode04/barcode04.haplotagged.bam" --output "mdepth.barcode04.$(date +%Y%m%d).out.txt"

```








